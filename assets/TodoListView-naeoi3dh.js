import{r as k,c as u,o as d,a as t,w as V,v as E,n as N,u as c,F as U,e as $,b as g,t as w,g as b,h as F,i as L,j as H,d as m,f as T,G as x,k as z,l as P,D as B,m as G,p as j,q as M}from"./index-C4N_SISn.js";const q={class:"todoList_Content"},K={class:"inputBox"},R={class:"todoList_list"},J={class:"todoList_tab"},Q={class:"todoList_items"},W={class:"todoList_item"},X={key:0,class:"inputBox"},Y=["onUpdate:modelValue"],Z=["onClick"],ee={key:1},te={key:2,class:"todoList_label"},ae=["onUpdate:modelValue","onClick"],se=["onClick"],le=["onClick"],oe={class:"todoList_statistics"},ne={key:0},ie={key:1},ue={key:2},de={__name:"TodosList",props:{todoDatas:{type:Array,required:!0}},emits:["add-todo","edit-todo","delete-todo","switch-todo-status"],setup(p,{emit:h}){const r=p,v=h,e=Object.freeze({All:"all",FINISH:"Finish",UNFINISH:"UNFINISH"}),l=k(e.All),f=k({content:""}),S=a=>r.todoDatas.filter(o=>o.status===a),C=()=>l.value===e.All?r.todoDatas:l.value===e.FINISH?r.todoDatas.filter(a=>a.status===!0):r.todoDatas.filter(a=>a.status===!1),y=a=>{l.value=a},O=()=>{if(f.value.content.trim()===""){alert("請輸入代辦事項內容");return}v("add-todo",f.value,()=>{f.value=""})},D=a=>{v("delete-todo",a)},I=a=>{a.status=!a.status,v("switch-todo-status",a)},s=a=>{a.isEditing=!0},i=async a=>{try{a.isEditing=!1,v("edit-todo",a)}catch(o){console.error(o)}};return(a,o)=>(d(),u("div",q,[t("div",K,[V(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":o[0]||(o[0]=n=>f.value.content=n)},null,512),[[E,f.value.content]]),t("a",{onClick:O},[...o[4]||(o[4]=[t("i",{class:"fa fa-plus"},null,-1)])])]),t("div",R,[t("ul",J,[t("li",null,[t("a",{class:N({active:l.value===c(e).All}),onClick:o[1]||(o[1]=n=>y(c(e).All))},"全部",2)]),t("li",null,[t("a",{class:N({active:l.value===c(e).UNFINISH}),onClick:o[2]||(o[2]=n=>y(c(e).UNFINISH))},"待完成",2)]),t("li",null,[t("a",{class:N({active:l.value===c(e).FINISH}),onClick:o[3]||(o[3]=n=>y(c(e).FINISH))},"已完成",2)])]),t("div",Q,[t("ul",W,[(d(!0),u(U,null,$(C(),(n,A)=>(d(),u("li",{key:A},[n.isEditing?(d(),u("div",X,[V(t("input",{type:"text","onUpdate:modelValue":_=>n.content=_},null,8,Y),[[E,n.content]]),n.isEditing?(d(),u("a",{key:0,onClick:_=>i(n)},[...o[5]||(o[5]=[t("i",{class:"fa-solid fa-floppy-disk",style:{color:"aliceblue"}},null,-1)])],8,Z)):g("",!0)])):(d(),u("div",ee)),n.isEditing?g("",!0):(d(),u("label",te,[V(t("input",{class:"todoList_input",type:"checkbox",value:"true","onUpdate:modelValue":_=>n.status=_,onClick:_=>I(n)},null,8,ae),[[b,n.status]]),t("span",null,w(n.content),1)])),n.isEditing?g("",!0):(d(),u("a",{key:3,onClick:_=>s(n)},[...o[6]||(o[6]=[t("i",{class:"fa fa-pencil",style:{color:"brown"}},null,-1)])],8,se)),n.isEditing?g("",!0):(d(),u("a",{key:4,onClick:_=>D(n.id)},[...o[7]||(o[7]=[t("i",{class:"fa fa-times",style:{color:"brown"}},null,-1)])],8,le))]))),128))]),t("div",oe,[p.todoDatas.length==0?(d(),u("span",ne," 目前尚無待辦事項 ")):g("",!0),p.todoDatas.length!=0&&(l.value===c(e).UNFINISH||l.value===c(e).All)?(d(),u("span",ie,w(S(!1).length)+" 個未完成項目 ",1)):p.todoDatas.length!=0&&l.value===c(e).FINISH?(d(),u("span",ue,w(S(!0).length)+" 個已完成項目 ",1)):g("",!0)])])])]))}},ce={id:"todoListPage",class:"bg-half"},re={class:"todo_sm"},ve={href:"#/todoList"},he={class:"conatiner todoListPage vhContainer"},_e={__name:"TodoListView",setup(p){const h=k([]),r=k(!1),v=L("getUserData",{nickname:"訪客",uid:""}),e=L("LoadingConfig"),l=k(""),f=async()=>{e.value.message="代辦事項載入中…",e.value.modelValue=!0,await m.get(T(x),{headers:{Authorization:l.value}}).then(s=>{console.log(s),r.value==!1&&(r.value=!0),h.value=s.data.data}).catch(s=>{console.log(s)}).finally(()=>{e.value.modelValue=!1})},S=async()=>{e.value.message="正在登出...",e.value.modelValue=!0,await m.post(T(z),{},{headers:{Authorization:l.value}}).then(s=>{console.log(s),r.value=!1,l.value="",alert("已成功登出"),window.location.href="#/"}).catch(s=>{console.log(s)}).finally(()=>{e.value.modelValue=!1})},C=async(s,i)=>{e.value.message="正在新增項目...",e.value.modelValue=!0,await m.post(T(M),s,{headers:{Authorization:l.value}}).then(a=>{a.data.status===!0&&h.value.push(a.data.newTodo),alert("新增待辦事項成功！"),i()}).catch(a=>{console.log(`POST_TODOS : ${a}`)}).finally(()=>{e.value.modelValue=!1})},y=async s=>{e.value.message="正在修改項目...",e.value.modelValue=!0;const i={content:s.content};await m.put(T(j,{id:s.id}),i,{headers:{Authorization:l}}).then(a=>{alert("修改待辦事項成功！")}).catch(a=>{console.log(`POST_TODOS : ${a}`)}).finally(()=>{e.value.modelValue=!1})},O=async s=>{e.value.message="正在調整項目...",e.value.modelValue=!0,await m.patch(T(G,{id:s.id}),null,{headers:{Authorization:l.value}}).then(i=>{alert("更改待辦事項成功！")}).catch(i=>{console.log(i)}).finally(()=>{e.value.modelValue=!1})},D=async s=>{e.value.message="正在刪除項目...",e.value.modelValue=!0,await m.delete(T(B,{id:s}),{headers:{Authorization:l.value}}).then(i=>{alert("已刪除代辦事項!"),h.value=h.value.filter(a=>a.id!==s)}).catch(i=>{console.log(i)}).finally(()=>{e.value.modelValue=!1})},I=async()=>(l.value=document.cookie.replace(/(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$/i,"$1"),l.value===""?(alert("登入驗證已過期，請重新登入"),window.location.href="#/",!1):(await m.get(T(P),{headers:{Authorization:l.value}}).then(s=>{v.value=s.data,console.log(v.value)}).catch(s=>(alert("登入驗證已過期，請重新登入"),window.location.href="#/",!1)),!0));return F(async()=>{await I()!=!1&&f()}),(s,i)=>(d(),u("div",ce,[t("nav",null,[i[0]||(i[0]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",re,[t("a",ve,[t("span",null,w(c(v).nickname)+" 的代辦",1)])]),t("li",null,[t("a",{href:"#",onClick:S},"登出")])])]),t("div",he,[H(de,{todoDatas:h.value,onAddTodo:C,onEditTodo:y,onSwitchTodoStatus:O,onDeleteTodo:D},null,8,["todoDatas"])])]))}};export{_e as default};
